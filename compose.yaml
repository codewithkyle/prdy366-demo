services:
  migrate:
    image: ghcr.io/amacneil/dbmate:latest
    environment:
      DATABASE_URL: ${DATABASE_URL}
    volumes:
      - ./db/migrations:/db/migrations:ro
    command: ["--wait", "--migrations-dir=/db/migrations", "up"]
  app:
    build: .
    depends_on:
      migrate:
        condition: service_completed_successfully
